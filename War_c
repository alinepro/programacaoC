#include <stdio.h>   // Biblioteca para entrada e sa√≠da (printf, scanf, fgets)
#include <stdlib.h>  // Biblioteca para aloca√ß√£o din√¢mica (calloc, free) e rand
#include <string.h>  // Biblioteca para manipula√ß√£o de strings (strcpy)
#include <time.h>    // Biblioteca para usar o tempo como semente do rand

#define QTD_TERRITORIOS 5  // Quantidade fixa de territ√≥rios
#define TAM 50             // Tamanho m√°ximo para strings

/* Estrutura que representa um territ√≥rio do jogo */
typedef struct {
    char nome[TAM];   // Nome do territ√≥rio
    char cor[TAM];    // Cor do ex√©rcito dominante
    int tropas;       // Quantidade de tropas no territ√≥rio
} Territorio;

/* Fun√ß√£o respons√°vel por exibir o estado atual do mapa */
void exibirMapa(Territorio *t) {

    // Percorre todos os territ√≥rios
    printf("\nüìç ESTADO ATUAL DO MAPA üìç\n");
    for (int i = 0; i < QTD_TERRITORIOS; i++) {

        // Exibe os dados de cada territ√≥rio
        printf("Territ√≥rio %d\n", i + 1);
        printf("Nome: %s", t[i].nome);
        printf("Cor do Ex√©rcito: %s", t[i].cor);
        printf("Tropas: %d\n\n", t[i].tropas);
    }
}

/* Fun√ß√£o que simula uma batalha entre dois territ√≥rios */
void atacar(Territorio *t, int atk, int def) {

    // Gera valores aleat√≥rios entre 1 e 6 para ataque e defesa
    int dadoAtk = rand() % 6 + 1;
    int dadoDef = rand() % 6 + 1;

    // Exibe os dados sorteados
    printf("\n‚öîÔ∏è BATALHA ‚öîÔ∏è\n");
    printf("Atacante (%s) rolou: %d\n", t[atk].nome, dadoAtk);
    printf("Defensor (%s) rolou: %d\n", t[def].nome, dadoDef);

    // Verifica o resultado da batalha
    // Empate favorece o atacante
    if (dadoAtk >= dadoDef) {

        // Defensor perde uma tropa
        t[def].tropas--;
        printf("‚û°Ô∏è Atacante venceu! Defensor perde 1 tropa.\n");

        // Se o defensor ficar sem tropas, o territ√≥rio √© conquistado
        if (t[def].tropas <= 0) {
            printf("üè≥Ô∏è Territ√≥rio conquistado!\n");

            // A cor do territ√≥rio passa a ser a do atacante
            strcpy(t[def].cor, t[atk].cor);

            // Territ√≥rio conquistado inicia com 1 tropa
            t[def].tropas = 1;
        }

    } else {
        // Caso o defensor ven√ßa
        printf("üõ°Ô∏è Defensor resistiu ao ataque.\n");
    }
}

int main() {

    // Ponteiro para armazenar os territ√≥rios alocados dinamicamente
    Territorio *territorios;

    // Aloca√ß√£o din√¢mica de mem√≥ria para 5 territ√≥rios
    territorios = (Territorio *) calloc(QTD_TERRITORIOS, sizeof(Territorio));

    // Verifica√ß√£o de erro na aloca√ß√£o
    if (territorios == NULL) {
        printf("Erro de aloca√ß√£o de mem√≥ria.\n");
        return 1;
    }

    /* Cadastro dos territ√≥rios */
    for (int i = 0; i < QTD_TERRITORIOS; i++) {

        printf("\nCadastro do Territ√≥rio %d\n", i + 1);

        // Leitura do nome do territ√≥rio
        printf("Nome: ");
        fgets(territorios[i].nome, TAM, stdin);

        // Leitura da cor do ex√©rcito
        printf("Cor do Ex√©rcito: ");
        fgets(territorios[i].cor, TAM, stdin);

        // Leitura da quantidade de tropas
        printf("N√∫mero de tropas: ");
        scanf("%d", &territorios[i].tropas);

        // Limpa o buffer do teclado para evitar problemas com fgets
        getchar();
    }

    // Inicializa o gerador de n√∫meros aleat√≥rios
    srand(time(NULL));

    // Exibe o mapa inicial
    exibirMapa(territorios);

    /* Loop principal da fase de batalhas */
    int atacante, defensor;
    char continuar;

    do {
        // Usu√°rio escolhe o territ√≥rio atacante
        printf("Escolha o territ√≥rio ATACANTE (1 a 5): ");
        scanf("%d", &atacante);

        // Usu√°rio escolhe o territ√≥rio defensor
        printf("Escolha o territ√≥rio DEFENSOR (1 a 5): ");
        scanf("%d", &defensor);

        // Limpa o buffer
        getchar();

        // Verifica se a escolha √© v√°lida
        if (atacante >= 1 && atacante <= 5 &&
            defensor >= 1 && defensor <= 5 &&
            atacante != defensor) {

            // Executa a batalha
            atacar(territorios, atacante - 1, defensor - 1);

        } else {
            printf("‚ùå Escolha inv√°lida.\n");
        }

        // Exibe o mapa ap√≥s a batalha
        exibirMapa(territorios);

        // Pergunta se o jogador deseja continuar
        printf("Deseja continuar atacando? (s/n): ");
        scanf("%c", &continuar);
        getchar();

    } while (continuar == 's' || continuar == 'S');

    // Libera a mem√≥ria alocada dinamicamente
    free(territorios);

    return 0; // Finaliza o programa com sucesso
}
